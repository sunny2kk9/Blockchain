{"ast":null,"code":"import { ethers } from 'ethers';\nimport contractInfo from '../contractInfo.json';\n\n// Contract ABI - Application Binary Interface\nconst CONTRACT_ABI = [\"function getValue() public view returns (uint256)\", \"function setValue(uint256 _value) public\", \"event ValueChanged(uint256 oldValue, uint256 newValue)\"];\n\n// Allowed test network chain IDs (mainnet = 1 is NOT allowed)\nconst ALLOWED_TEST_NETWORKS = {\n  1337: 'Hardhat Local',\n  11155111: 'Sepolia',\n  5: 'Goerli',\n  80001: 'Mumbai (Polygon Testnet)',\n  97: 'BSC Testnet',\n  421613: 'Arbitrum Goerli',\n  43113: 'Avalanche Fuji'\n};\n\n// Mainnet chain ID - explicitly blocked\nconst MAINNET_CHAIN_ID = 1;\nlet contract = null;\nlet provider = null;\nlet signer = null;\n\n// Check if current network is a test network\nexport const checkNetwork = async () => {\n  if (typeof window.ethereum === 'undefined') {\n    throw new Error('MetaMask is not installed. Please install MetaMask to use this app.');\n  }\n  const chainId = await window.ethereum.request({\n    method: 'eth_chainId'\n  });\n  const chainIdDecimal = parseInt(chainId, 16);\n\n  // Block mainnet explicitly\n  if (chainIdDecimal === MAINNET_CHAIN_ID) {\n    throw new Error('⚠️ Mainnet is not allowed! This app only works with test networks. ' + 'Please switch to a test network (Hardhat Local, Sepolia, Goerli, etc.) in MetaMask.');\n  }\n\n  // Check if it's an allowed test network\n  if (!ALLOWED_TEST_NETWORKS[chainIdDecimal]) {\n    throw new Error(`⚠️ Unsupported network (Chain ID: ${chainIdDecimal}). ` + `Please switch to one of these test networks: ${Object.values(ALLOWED_TEST_NETWORKS).join(', ')}`);\n  }\n  return {\n    chainId: chainIdDecimal,\n    networkName: ALLOWED_TEST_NETWORKS[chainIdDecimal]\n  };\n};\n\n// Switch to localhost network if available\nexport const switchToLocalhost = async () => {\n  try {\n    await window.ethereum.request({\n      method: 'wallet_switchEthereumChain',\n      params: [{\n        chainId: '0x539'\n      }] // 1337 in hex\n    });\n  } catch (switchError) {\n    // If the chain doesn't exist, try to add it\n    if (switchError.code === 4902) {\n      try {\n        await window.ethereum.request({\n          method: 'wallet_addEthereumChain',\n          params: [{\n            chainId: '0x539',\n            chainName: 'Hardhat Local',\n            nativeCurrency: {\n              name: 'ETH',\n              symbol: 'ETH',\n              decimals: 18\n            },\n            rpcUrls: ['http://127.0.0.1:8545'],\n            blockExplorerUrls: null\n          }]\n        });\n      } catch (addError) {\n        throw new Error('Failed to add Hardhat Local network to MetaMask');\n      }\n    } else {\n      throw switchError;\n    }\n  }\n};\n\n// Initialize provider and contract\nexport const initContract = async () => {\n  if (typeof window.ethereum !== 'undefined') {\n    // Check network before initializing\n    const networkInfo = await checkNetwork();\n    provider = new ethers.BrowserProvider(window.ethereum);\n    signer = await provider.getSigner();\n    contract = new ethers.Contract(contractInfo.address, CONTRACT_ABI, signer);\n    return {\n      contract,\n      networkInfo\n    };\n  } else {\n    throw new Error('MetaMask is not installed. Please install MetaMask to use this app.');\n  }\n};\n\n// Connect wallet\nexport const connectWallet = async () => {\n  if (typeof window.ethereum !== 'undefined') {\n    try {\n      // Request account access\n      const accounts = await window.ethereum.request({\n        method: 'eth_requestAccounts'\n      });\n\n      // Check network before initializing\n      const networkInfo = await checkNetwork();\n\n      // Initialize contract after connecting\n      await initContract();\n      return {\n        account: accounts[0],\n        networkInfo\n      };\n    } catch (error) {\n      var _error$message, _error$message2;\n      if ((_error$message = error.message) !== null && _error$message !== void 0 && _error$message.includes('Mainnet') || (_error$message2 = error.message) !== null && _error$message2 !== void 0 && _error$message2.includes('test network')) {\n        throw error; // Re-throw network errors as-is\n      }\n      throw new Error('User rejected the connection request');\n    }\n  } else {\n    throw new Error('MetaMask is not installed. Please install MetaMask extension.');\n  }\n};\n\n// Get contract instance\nexport const getContract = async () => {\n  if (!contract) {\n    const result = await initContract();\n    contract = result.contract;\n  }\n  return contract;\n};\n\n// Get current value from contract\nexport const getCurrentValue = async () => {\n  try {\n    const contractInstance = await getContract();\n    const value = await contractInstance.getValue();\n    return value.toString();\n  } catch (error) {\n    throw new Error(`Failed to get value: ${error.message}`);\n  }\n};\n\n// Set new value in contract\nexport const setValue = async value => {\n  try {\n    const contractInstance = await getContract();\n    const tx = await contractInstance.setValue(value);\n    return tx;\n  } catch (error) {\n    var _error$message3, _error$message4;\n    // Check for user rejection in various error formats\n    if (error.code === 4001 || error.code === 'ACTION_REJECTED' || (_error$message3 = error.message) !== null && _error$message3 !== void 0 && _error$message3.includes('user rejected') || (_error$message4 = error.message) !== null && _error$message4 !== void 0 && _error$message4.includes('User denied') || error.reason === 'rejected') {\n      throw new Error('Transaction cancelled. You rejected the transaction in MetaMask.');\n    }\n    throw new Error(`Failed to set value: ${error.message}`);\n  }\n};","map":{"version":3,"names":["ethers","contractInfo","CONTRACT_ABI","ALLOWED_TEST_NETWORKS","MAINNET_CHAIN_ID","contract","provider","signer","checkNetwork","window","ethereum","Error","chainId","request","method","chainIdDecimal","parseInt","Object","values","join","networkName","switchToLocalhost","params","switchError","code","chainName","nativeCurrency","name","symbol","decimals","rpcUrls","blockExplorerUrls","addError","initContract","networkInfo","BrowserProvider","getSigner","Contract","address","connectWallet","accounts","account","error","_error$message","_error$message2","message","includes","getContract","result","getCurrentValue","contractInstance","value","getValue","toString","setValue","tx","_error$message3","_error$message4","reason"],"sources":["/Users/moriro/Codes/Assignment 2/frontend/src/utils/web3.js"],"sourcesContent":["import { ethers } from 'ethers';\nimport contractInfo from '../contractInfo.json';\n\n// Contract ABI - Application Binary Interface\nconst CONTRACT_ABI = [\n  \"function getValue() public view returns (uint256)\",\n  \"function setValue(uint256 _value) public\",\n  \"event ValueChanged(uint256 oldValue, uint256 newValue)\"\n];\n\n// Allowed test network chain IDs (mainnet = 1 is NOT allowed)\nconst ALLOWED_TEST_NETWORKS = {\n  1337: 'Hardhat Local',\n  11155111: 'Sepolia',\n  5: 'Goerli',\n  80001: 'Mumbai (Polygon Testnet)',\n  97: 'BSC Testnet',\n  421613: 'Arbitrum Goerli',\n  43113: 'Avalanche Fuji'\n};\n\n// Mainnet chain ID - explicitly blocked\nconst MAINNET_CHAIN_ID = 1;\n\nlet contract = null;\nlet provider = null;\nlet signer = null;\n\n// Check if current network is a test network\nexport const checkNetwork = async () => {\n  if (typeof window.ethereum === 'undefined') {\n    throw new Error('MetaMask is not installed. Please install MetaMask to use this app.');\n  }\n\n  const chainId = await window.ethereum.request({ method: 'eth_chainId' });\n  const chainIdDecimal = parseInt(chainId, 16);\n\n  // Block mainnet explicitly\n  if (chainIdDecimal === MAINNET_CHAIN_ID) {\n    throw new Error(\n      '⚠️ Mainnet is not allowed! This app only works with test networks. ' +\n      'Please switch to a test network (Hardhat Local, Sepolia, Goerli, etc.) in MetaMask.'\n    );\n  }\n\n  // Check if it's an allowed test network\n  if (!ALLOWED_TEST_NETWORKS[chainIdDecimal]) {\n    throw new Error(\n      `⚠️ Unsupported network (Chain ID: ${chainIdDecimal}). ` +\n      `Please switch to one of these test networks: ${Object.values(ALLOWED_TEST_NETWORKS).join(', ')}`\n    );\n  }\n\n  return {\n    chainId: chainIdDecimal,\n    networkName: ALLOWED_TEST_NETWORKS[chainIdDecimal]\n  };\n};\n\n// Switch to localhost network if available\nexport const switchToLocalhost = async () => {\n  try {\n    await window.ethereum.request({\n      method: 'wallet_switchEthereumChain',\n      params: [{ chainId: '0x539' }], // 1337 in hex\n    });\n  } catch (switchError) {\n    // If the chain doesn't exist, try to add it\n    if (switchError.code === 4902) {\n      try {\n        await window.ethereum.request({\n          method: 'wallet_addEthereumChain',\n          params: [{\n            chainId: '0x539',\n            chainName: 'Hardhat Local',\n            nativeCurrency: {\n              name: 'ETH',\n              symbol: 'ETH',\n              decimals: 18\n            },\n            rpcUrls: ['http://127.0.0.1:8545'],\n            blockExplorerUrls: null\n          }],\n        });\n      } catch (addError) {\n        throw new Error('Failed to add Hardhat Local network to MetaMask');\n      }\n    } else {\n      throw switchError;\n    }\n  }\n};\n\n// Initialize provider and contract\nexport const initContract = async () => {\n  if (typeof window.ethereum !== 'undefined') {\n    // Check network before initializing\n    const networkInfo = await checkNetwork();\n    \n    provider = new ethers.BrowserProvider(window.ethereum);\n    signer = await provider.getSigner();\n    contract = new ethers.Contract(contractInfo.address, CONTRACT_ABI, signer);\n    \n    return { contract, networkInfo };\n  } else {\n    throw new Error('MetaMask is not installed. Please install MetaMask to use this app.');\n  }\n};\n\n// Connect wallet\nexport const connectWallet = async () => {\n  if (typeof window.ethereum !== 'undefined') {\n    try {\n      // Request account access\n      const accounts = await window.ethereum.request({\n        method: 'eth_requestAccounts'\n      });\n      \n      // Check network before initializing\n      const networkInfo = await checkNetwork();\n      \n      // Initialize contract after connecting\n      await initContract();\n      \n      return { account: accounts[0], networkInfo };\n    } catch (error) {\n      if (error.message?.includes('Mainnet') || error.message?.includes('test network')) {\n        throw error; // Re-throw network errors as-is\n      }\n      throw new Error('User rejected the connection request');\n    }\n  } else {\n    throw new Error('MetaMask is not installed. Please install MetaMask extension.');\n  }\n};\n\n// Get contract instance\nexport const getContract = async () => {\n  if (!contract) {\n    const result = await initContract();\n    contract = result.contract;\n  }\n  return contract;\n};\n\n// Get current value from contract\nexport const getCurrentValue = async () => {\n  try {\n    const contractInstance = await getContract();\n    const value = await contractInstance.getValue();\n    return value.toString();\n  } catch (error) {\n    throw new Error(`Failed to get value: ${error.message}`);\n  }\n};\n\n// Set new value in contract\nexport const setValue = async (value) => {\n  try {\n    const contractInstance = await getContract();\n    const tx = await contractInstance.setValue(value);\n    return tx;\n  } catch (error) {\n    // Check for user rejection in various error formats\n    if (error.code === 4001 || \n        error.code === 'ACTION_REJECTED' ||\n        error.message?.includes('user rejected') ||\n        error.message?.includes('User denied') ||\n        error.reason === 'rejected') {\n      throw new Error('Transaction cancelled. You rejected the transaction in MetaMask.');\n    }\n    throw new Error(`Failed to set value: ${error.message}`);\n  }\n};\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}